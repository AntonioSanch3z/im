<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IM Service Installation &mdash; IM 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/grycap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="IM 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Resource and Application Description Language (RADL)" href="radl.html" />
    <link rel="prev" title="IM Videos" href="videos.html" /> 
  </head>
  <body>
<div id="main-wrapper">
    <div id="logo">
       <div class="img"><img height="90" src="_static/logo.png"></img></div>
    </div>
    <div class="break hole"></div>
    <div id="menu">
      <div id="menu-text">
         <ul>
            <li><a href="../index.php">Home</a>
            </li><li><a href="../overview.php">Overview</a>            
            </li><li><a href="../usecases.php">Use Cases</a>
            </li><li><a href="../download.php">Download</a>
            </li><li><a href="index.html">Documentation</a>
            </li><li class="last"><a href="../about.php">About</a>
         </li></ul>
      </div>
    </div>
    <div class="break hole"></div>
    <div id="content">
      <div id="contentwrapper">
        
  <div class="section" id="im-service-installation">
<h1>IM Service Installation<a class="headerlink" href="#im-service-installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>IM needs at least Python 2.4 to run, as well as the next libraries:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.dabeaz.com/ply/">PLY</a>, Python Lex &amp; Yacc library for python.</li>
<li><a class="reference external" href="http://www.lag.net/paramiko/">paramiko</a>, ssh2 protocol library for python.</li>
<li><a class="reference external" href="http://pyyaml.org/">PyYAML</a>, a YAML parser.</li>
<li><a class="reference external" href="http://pywebsvcs.sourceforge.net/">SOAPpy</a>, a full-featured SOAP library
(we know it is not actively supported by upstream anymore).</li>
</ul>
<p>Also, IM uses <a class="reference external" href="http://www.ansible.com">Ansible</a> (1.4.2 or later) to configure the
infrastructure nodes.</p>
<p>These components are usually available from the distribution repositories. To
install them in Debian and Ubuntu based distributions, do:</p>
<div class="highlight-python"><div class="highlight"><pre>$ apt-get install python-ply python-paramiko python-yaml python-soappy ansible
</pre></div>
</div>
<p>In Red Hat based distributions (RHEL, CentOS, Amazon Linux, Oracle Linux,
Fedora, etc.), do:</p>
<div class="highlight-python"><div class="highlight"><pre>$ yum install python-ply python-paramiko PyYAML SOAPpy ansible
</pre></div>
</div>
<p>Finally, check the next values in the Ansible configuration file
<tt class="file docutils literal"><span class="pre">ansible.cfg</span></tt>, (usually found in <tt class="file docutils literal"><span class="pre">/etc/ansible</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">host_key_checking</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">transport</span> <span class="o">=</span> <span class="n">paramiko</span>
<span class="n">record_host_keys</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-packages">
<h2>Optional Packages<a class="headerlink" href="#optional-packages" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://libcloud.apache.org/">apache-libcloud</a> 0.15 or later is used in the
LibCloud connector.</li>
<li><a class="reference external" href="http://boto.readthedocs.org">boto</a> 2.19.0 or later is used as interface to
Amazon EC2. It is available as package named <tt class="docutils literal"><span class="pre">python-boto</span></tt> in Debian based
distributions. It can also be downloaded from <a class="reference external" href="https://github.com/boto/boto">boto GitHub repository</a>.
Download the file and copy the boto subdirectory into the IM install path.</li>
<li><a class="reference external" href="http://springpython.webfactional.com/">Spring Python</a> framework is needed
if the access to XML-RPC API is secured with SSL certificates (see
<a class="reference internal" href="#confval-XMLRCP_SSL"><tt class="xref std std-confval docutils literal"><span class="pre">XMLRCP_SSL</span></tt></a>).
The Debian package is named <tt class="docutils literal"><span class="pre">python-springpython</span></tt>.</li>
<li><a class="reference external" href="http://cherrypy.org">CherryPy</a> is needed if needed to secure the REST API
with SSL certificates (see <a class="reference internal" href="#confval-REST_SSL"><tt class="xref std std-confval docutils literal"><span class="pre">REST_SSL</span></tt></a>).
The Debian package is named <tt class="docutils literal"><span class="pre">python-cherrypy3</span></tt>.</li>
</ul>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="form-pip">
<h3>Form Pip<a class="headerlink" href="#form-pip" title="Permalink to this headline">¶</a></h3>
<p>You only have to call the install command of the pip tool with the IM package:</p>
<div class="highlight-python"><div class="highlight"><pre>$ pip install IM
</pre></div>
</div>
<p><strong>WARNING: In some linux distributions (REL 6 or equivalents) you must unistall
the packages python-paramiko and python-crypto before installing the IM with pip.</strong></p>
<p>Pip will install all the pre-requisites needed. So Ansible 1.4.2 or later will be
installed in the system. In some cases it will need to have installed the GCC
compiler and the python developer libraries (&#8216;python-dev&#8217; or &#8216;python-devel&#8217;
packages in main distributions).</p>
<p>You must also remember to modify the ansible.cfg file setting as specified in the
REQUISITES section.</p>
</div>
<div class="section" id="form-source">
<h3>Form Source<a class="headerlink" href="#form-source" title="Permalink to this headline">¶</a></h3>
<p>Once the dependences are installed, just download the tarball of <em>IM Service</em>
from <a class="reference external" href="http://www.grycap.upv.es/im/download.php">Download</a>, extract the
content and move the extracted directory to the installation path (for instance
<tt class="file docutils literal"><span class="pre">/usr/local</span></tt> or <tt class="file docutils literal"><span class="pre">/opt</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre>$ tar xvzf IM-0.1.tar.gz
$ sudo chown -R root:root IM-0.1.tar.gz
$ sudo mv IM-0.1 /usr/local
</pre></div>
</div>
<p>Finally you must copy (or link) $IM_PATH/im file to /etc/init.d directory:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo ln -s /usr/local/IM-0.1/im /etc/init.d
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>If you want the IM Service to be started at boot time, do</p>
<ol class="arabic">
<li><p class="first">Update the value of the variable <tt class="docutils literal"><span class="pre">IMDAEMON</span></tt> in <tt class="file docutils literal"><span class="pre">/etc/init.d/im</span></tt> file
to the path where the IM im_service.py file is installed (e.g. /usr/local/im/im_service.py),
or set the name of the script file (im_service.py) if the file is in the PATH
(pip puts the im_service.py file in the PATH as default):</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo sed -i &#39;s/`IMDAEMON=.*/`IMDAEMON=/usr/local/IM-0.1/im_service.py&#39;/etc/init.d/im
</pre></div>
</div>
</li>
<li><p class="first">Register the service.</p>
</li>
</ol>
<p>To do the last step on a Debian based distributions, execute:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo update-rc.d im start 99 2 3 4 5 . stop 05 0 1 6 .
</pre></div>
</div>
<p>or the next command on Red Hat based:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo chkconfig im on
</pre></div>
</div>
<p>Alternatively, it can be done manually:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ln -s /etc/init.d/im /etc/rc2.d/S99im
$ ln -s /etc/init.d/im /etc/rc3.d/S99im
$ ln -s /etc/init.d/im /etc/rc5.d/S99im
$ ln -s /etc/init.d/im /etc/rc1.d/K05im
$ ln -s /etc/init.d/im /etc/rc6.d/K05im
</pre></div>
</div>
<p>IM reads the configuration from <tt class="file docutils literal"><span class="pre">$IM_PATH/etc/im.cfg</span></tt>, and if it is not
available, does from <tt class="docutils literal"><span class="pre">/etc/im/im.cfg</span></tt>. There is a template of <tt class="file docutils literal"><span class="pre">im.cfg</span></tt>
at the directory <tt class="file docutils literal"><span class="pre">etc</span></tt> on the tarball. The options are explained next.</p>
<div class="section" id="basic-options">
<h3>Basic Options<a class="headerlink" href="#basic-options" title="Permalink to this headline">¶</a></h3>
<dl class="confval">
<dt id="confval-DATA_FILE">
<tt class="descname">DATA_FILE</tt><a class="headerlink" href="#confval-DATA_FILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the data file.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/inf.dat</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-MAX_VM_FAILS">
<tt class="descname">MAX_VM_FAILS</tt><a class="headerlink" href="#confval-MAX_VM_FAILS" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of attempts to launch a virtual machine before considering it
an error.
The default value is 3.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-WAIT_RUNNING_VM_TIMEOUT">
<tt class="descname">WAIT_RUNNING_VM_TIMEOUT</tt><a class="headerlink" href="#confval-WAIT_RUNNING_VM_TIMEOUT" title="Permalink to this definition">¶</a></dt>
<dd><p>Timeout in seconds to get a virtual machine in running state.
The default value is 1800.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-LOG_FILE">
<tt class="descname">LOG_FILE</tt><a class="headerlink" href="#confval-LOG_FILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the log file.
The default value is <tt class="file docutils literal"><span class="pre">/var/log/im/inf.log</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-LOG_FILE_MAX_SIZE">
<tt class="descname">LOG_FILE_MAX_SIZE</tt><a class="headerlink" href="#confval-LOG_FILE_MAX_SIZE" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum size in KiB of the log file before being rotated.
The default value is 10485760.</p>
</dd></dl>

</div>
<div class="section" id="default-virtual-machine-options">
<h3>Default Virtual Machine Options<a class="headerlink" href="#default-virtual-machine-options" title="Permalink to this headline">¶</a></h3>
<dl class="confval">
<dt id="confval-DEFAULT_VM_MEMORY">
<tt class="descname">DEFAULT_VM_MEMORY</tt><a class="headerlink" href="#confval-DEFAULT_VM_MEMORY" title="Permalink to this definition">¶</a></dt>
<dd><p>Default principal memory assigned to a virtual machine.
The default value is 512.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-DEFAULT_VM_MEMORY_UNIT">
<tt class="descname">DEFAULT_VM_MEMORY_UNIT</tt><a class="headerlink" href="#confval-DEFAULT_VM_MEMORY_UNIT" title="Permalink to this definition">¶</a></dt>
<dd><p>Unit used in <a class="reference internal" href="#confval-DEFAULT_VM_MEMORY"><tt class="xref std std-confval docutils literal"><span class="pre">DEFAULT_VM_MEMORY</span></tt></a>.
Allowed values: <tt class="docutils literal"><span class="pre">K</span></tt> (KiB), <tt class="docutils literal"><span class="pre">M</span></tt> (MiB) and <tt class="docutils literal"><span class="pre">G</span></tt> (GiB).
The default value is <tt class="docutils literal"><span class="pre">M</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-DEFAULT_VM_CPUS">
<tt class="descname">DEFAULT_VM_CPUS</tt><a class="headerlink" href="#confval-DEFAULT_VM_CPUS" title="Permalink to this definition">¶</a></dt>
<dd><p>Default number of CPUs assigned to a virtual machine.
The default value is 1.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-DEFAULT_VM_CPU_ARCH">
<tt class="descname">DEFAULT_VM_CPU_ARCH</tt><a class="headerlink" href="#confval-DEFAULT_VM_CPU_ARCH" title="Permalink to this definition">¶</a></dt>
<dd><p>Default CPU architecture assigned to a virtual machine.
Allowed values: <tt class="docutils literal"><span class="pre">i386</span></tt> and <tt class="docutils literal"><span class="pre">x86_64</span></tt>.
The default value is <tt class="docutils literal"><span class="pre">x86_64</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-DEFAULT_MASTERVM_NAME">
<tt class="descname">DEFAULT_MASTERVM_NAME</tt><a class="headerlink" href="#confval-DEFAULT_MASTERVM_NAME" title="Permalink to this definition">¶</a></dt>
<dd><p>Default name of virtual machine with the <em>master</em> role.
The default value is <tt class="docutils literal"><span class="pre">vmmaster</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-DEFAULT_DOMAIN">
<tt class="descname">DEFAULT_DOMAIN</tt><a class="headerlink" href="#confval-DEFAULT_DOMAIN" title="Permalink to this definition">¶</a></dt>
<dd><p>Default domain assigned to a virtual machine.
The default value is <tt class="docutils literal"><span class="pre">localdomain</span></tt>.</p>
</dd></dl>

</div>
<div class="section" id="contextualization">
<h3>Contextualization<a class="headerlink" href="#contextualization" title="Permalink to this headline">¶</a></h3>
<dl class="confval">
<dt id="confval-CONTEXTUALIZATION_DIR">
<tt class="descname">CONTEXTUALIZATION_DIR</tt><a class="headerlink" href="#confval-CONTEXTUALIZATION_DIR" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the IM contextualization files.
The default value is <tt class="file docutils literal"><span class="pre">/usr/share/im/contextualization</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-RECIPES_DIR">
<tt class="descname">RECIPES_DIR</tt><a class="headerlink" href="#confval-RECIPES_DIR" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the Ansible recipes directory.
The default value is <tt class="file docutils literal"><span class="pre">CONTEXTUALIZATION_DIR/AnsibleRecipes</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-RECIPES_DB_FILE">
<tt class="descname">RECIPES_DB_FILE</tt><a class="headerlink" href="#confval-RECIPES_DB_FILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the Ansible recipes database file.
The default value is <tt class="file docutils literal"><span class="pre">CONTEXTUALIZATION_DIR/recipes_ansible.db</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-MAX_CONTEXTUALIZATION_TIME">
<tt class="descname">MAX_CONTEXTUALIZATION_TIME</tt><a class="headerlink" href="#confval-MAX_CONTEXTUALIZATION_TIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum time in seconds spent on contextualize a virtual machine before
throwing an error.
The default value is 7200.</p>
</dd></dl>

</div>
<div class="section" id="xml-rpc-api">
<span id="options-xmlrpc"></span><h3>XML-RPC API<a class="headerlink" href="#xml-rpc-api" title="Permalink to this headline">¶</a></h3>
<dl class="confval">
<dt id="confval-XMLRCP_PORT">
<tt class="descname">XMLRCP_PORT</tt><a class="headerlink" href="#confval-XMLRCP_PORT" title="Permalink to this definition">¶</a></dt>
<dd><p>Port number where IM XML-RPC API is available.
The default value is 8899.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-XMLRCP_SSL">
<tt class="descname">XMLRCP_SSL</tt><a class="headerlink" href="#confval-XMLRCP_SSL" title="Permalink to this definition">¶</a></dt>
<dd><p>If <tt class="docutils literal"><span class="pre">True</span></tt> the XML-RPC API is secured with SSL certificates.
The default value is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-XMLRCP_SSL_KEYFILE">
<tt class="descname">XMLRCP_SSL_KEYFILE</tt><a class="headerlink" href="#confval-XMLRCP_SSL_KEYFILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the private key associated to the SSL certificate to access
the XML-RPC API.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/pki/server-key.pem</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-XMLRCP_SSL_CERTFILE">
<tt class="descname">XMLRCP_SSL_CERTFILE</tt><a class="headerlink" href="#confval-XMLRCP_SSL_CERTFILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the public key associated to the SSL certificate to access
the XML-RPC API.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/pki/server-cert.pem</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-XMLRCP_SSL_CA_CERTS">
<tt class="descname">XMLRCP_SSL_CA_CERTS</tt><a class="headerlink" href="#confval-XMLRCP_SSL_CA_CERTS" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the SSL Certification Authorities (CA) certificate.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/pki/ca-chain.pem</span></tt>.</p>
</dd></dl>

</div>
<div class="section" id="rest-api">
<span id="options-rest"></span><h3>REST API<a class="headerlink" href="#rest-api" title="Permalink to this headline">¶</a></h3>
<dl class="confval">
<dt id="confval-ACTIVATE_REST">
<tt class="descname">ACTIVATE_REST</tt><a class="headerlink" href="#confval-ACTIVATE_REST" title="Permalink to this definition">¶</a></dt>
<dd><p>If <tt class="docutils literal"><span class="pre">True</span></tt> the REST API is activated.
The default value is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-REST_PORT">
<tt class="descname">REST_PORT</tt><a class="headerlink" href="#confval-REST_PORT" title="Permalink to this definition">¶</a></dt>
<dd><p>Port number where REST API is available.
The default value is 8800.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-REST_SSL">
<tt class="descname">REST_SSL</tt><a class="headerlink" href="#confval-REST_SSL" title="Permalink to this definition">¶</a></dt>
<dd><p>If <tt class="docutils literal"><span class="pre">True</span></tt> the REST API is secured with SSL certificates.
The default value is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-REST_SSL_KEYFILE">
<tt class="descname">REST_SSL_KEYFILE</tt><a class="headerlink" href="#confval-REST_SSL_KEYFILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the private key associated to the SSL certificate to access
the REST API.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/pki/server-key.pem</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-REST_SSL_CERTFILE">
<tt class="descname">REST_SSL_CERTFILE</tt><a class="headerlink" href="#confval-REST_SSL_CERTFILE" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the public key associated to the SSL certificate to access
the REST API.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/pki/server-cert.pem</span></tt>.</p>
</dd></dl>

<dl class="confval">
<dt id="confval-REST_SSL_CA_CERTS">
<tt class="descname">REST_SSL_CA_CERTS</tt><a class="headerlink" href="#confval-REST_SSL_CA_CERTS" title="Permalink to this definition">¶</a></dt>
<dd><p>Full path to the SSL Certification Authorities (CA) certificate.
The default value is <tt class="file docutils literal"><span class="pre">/etc/im/pki/ca-chain.pem</span></tt>.</p>
</dd></dl>

</div>
</div>
</div>


      </div>
    </div>
</div>

    <div class="footer">
        &copy; Copyright 2014, Miguel Caballer Fernandez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>